O<solo-tool-change> SUB
#<_RapidFeed> = 300
#<_RapidFeedRotary> = 600

#<_tool1X> = 6.2153
#<_tool1Y> = 2.9225
#<_tool1Z> = -6.1170

#<_toolDist> = [ 40.75 / 25.4 ]
#<_middleOffsetX> = [ SQRT[3] * .5 * #<_toolDist> ]
#<_middleOffsetY> = [ .5 * #<_toolDist> ]

#<_oldTool> = #5400

o100 if [ #<_oldTool> EQ 0 ]
  #<_oldTool> = #<_ini[PENTA]LAST_TOOL>
o100 endif

#<_newTool> = #<T>

o200 if [ #<_oldTool> EQ #<_newTool> ]
  O<solo-tool-change> return
o200 endif
(debug, Tool #<T>)

M70                                            ( save current modal state )

G61

G90
G94
G40

G53 G1 Z0 F#<_RapidFeed>
G53 G1 B0 F#<_RapidFeedRotary>
M270

o[#<_oldTool> + 7000] call
o[#<_newTool> + 8000] call

M6 T[#<T>]

M271

M72                                          ( restore modal state )

O<solo-tool-change> ENDSUB

; tool 1
o7001 sub
  o<local-place-tool> call [#<_tool1X>] [#<_tool1Y>] [#<_tool1Z>]
o7001 endsub

; tool 2
o7002 sub
  o<local-place-tool> call [#<_tool1X>] [#<_tool1Y> - #<_toolDist>] [#<_tool1Z>]
o7002 endsub

; tool 3
o7003 sub
  o<local-place-tool> call [#<_tool1X>] [#<_tool1Y> - [ 2 * #<_toolDist> ]] [#<_tool1Z>]
o7003 endsub

; tool 4
o7004 sub
  o<local-place-tool> call [#<_tool1X>] [#<_tool1Y> - [ 3 * #<_toolDist> ]] [#<_tool1Z>]
o7004 endsub

; tool 5
o7005 sub
  o<local-place-tool> call [#<_tool1X>] [#<_tool1Y> - [ 4 * #<_toolDist> ]] [#<_tool1Z>]
o7005 endsub

; tool 6
o7006 sub
  o<local-place-tool> call [#<_tool1X> - #<_middleOffsetX> ] [#<_tool1Y> - #<_middleOffsetY> - #<_toolDist>] [#<_tool1Z>]
o7006 endsub

; tool 7
o7007 sub
  o<local-place-tool> call [#<_tool1X> - #<_middleOffsetX> ] [#<_tool1Y> - #<_middleOffsetY> - [ 2 * #<_toolDist> ]] [#<_tool1Z>]
o7007 endsub

; tool 8
o7008 sub
  o<local-place-tool> call [#<_tool1X> - #<_middleOffsetX> ] [#<_tool1Y> - #<_middleOffsetY> - [ 3 * #<_toolDist> ]] [#<_tool1Z>]
o7008 endsub

; tool 9
o7009 sub
  o<local-place-tool> call [#<_tool1X> - [ 2 * #<_middleOffsetX> ]] [#<_tool1Y>] [#<_tool1Z>]
o7009 endsub

; tool 10
o7010 sub
  o<local-place-tool> call [#<_tool1X> - [ 2 * #<_middleOffsetX> ]] [#<_tool1Y> - #<_toolDist>] [#<_tool1Z>]
o7010 endsub

; tool 11
o7011 sub
  o<local-place-tool> call [#<_tool1X> - [ 2 * #<_middleOffsetX> ]] [#<_tool1Y> - [ 2 * #<_toolDist> ]] [#<_tool1Z>]
o7011 endsub

; tool 12
o7012 sub
  o<local-place-tool> call [#<_tool1X> - [ 2 * #<_middleOffsetX> ]] [#<_tool1Y> - [ 3 * #<_toolDist> ]] [#<_tool1Z>]
o7012 endsub

; tool 13
o7013 sub
  o<local-place-tool> call [#<_tool1X> - [ 2 * #<_middleOffsetX> ]] [#<_tool1Y> - [ 4 * #<_toolDist> ]] [#<_tool1Z>]
o7013 endsub

o<local-place-tool> sub
  M66 P60 L0
  o7100 if [ #5399 NE 1 ]
    (debug,ERROR: No tool in spindle.)
    o<local-sync> call
    M2
  o7100 endif

  #<_toolX> = #1
  #<_toolY> = #2
  #<_toolZ> = #3
  #<_placeFeed> = 300
  G53 G1 F#<_placeFeed> X#<_toolX> Y#<_toolY>
  ;O<local-sync> call
  G53 G1 F#<_placeFeed> Z#<_toolZ>
  M260

  G53 G1 F#<_placeFeed> Z[ #<_toolZ> + 1 ]
  ;O<local-sync> call
o<local-place-tool> endsub

; tool 1
o8001 sub
  o<local-pick-up-tool> call [#<_tool1X>] [#<_tool1Y>] [#<_tool1Z>]
o8001 endsub

; tool 2
o8002 sub
  o<local-pick-up-tool> call [#<_tool1X>] [#<_tool1Y> - #<_toolDist>] [#<_tool1Z>]
o8002 endsub

; tool 3
o8003 sub
  o<local-pick-up-tool> call [#<_tool1X>] [#<_tool1Y> - [ 2 * #<_toolDist> ]] [#<_tool1Z>]
o8003 endsub

; tool 4
o8004 sub
  o<local-pick-up-tool> call [#<_tool1X>] [#<_tool1Y> - [ 3 * #<_toolDist> ]] [#<_tool1Z>]
o8004 endsub

; tool 5
o8005 sub
  o<local-pick-up-tool> call [#<_tool1X>] [#<_tool1Y> - [ 4 * #<_toolDist> ]] [#<_tool1Z>]
o8005 endsub

; tool 6
o8006 sub
  o<local-pick-up-tool> call [#<_tool1X> - #<_middleOffsetX> ] [#<_tool1Y> - #<_middleOffsetY> - #<_toolDist>] [#<_tool1Z>]
o8006 endsub

; tool 7
o8007 sub
  o<local-pick-up-tool> call [#<_tool1X> - #<_middleOffsetX> ] [#<_tool1Y> - #<_middleOffsetY> - [ 2 * #<_toolDist> ]] [#<_tool1Z>]
o8007 endsub

; tool 8
o8008 sub
  o<local-pick-up-tool> call [#<_tool1X> - #<_middleOffsetX> ] [#<_tool1Y> - #<_middleOffsetY> - [ 3 * #<_toolDist> ]] [#<_tool1Z>]
o8008 endsub

; tool 9
o8009 sub
  o<local-pick-up-tool> call [#<_tool1X> - [ 2 * #<_middleOffsetX> ]] [#<_tool1Y>] [#<_tool1Z>]
o8009 endsub

; tool 10
o8010 sub
  o<local-pick-up-tool> call [#<_tool1X> - [ 2 * #<_middleOffsetX> ]] [#<_tool1Y> - #<_toolDist>] [#<_tool1Z>]
o8010 endsub

; tool 11
o8011 sub
  o<local-pick-up-tool> call [#<_tool1X> - [ 2 * #<_middleOffsetX> ]] [#<_tool1Y> - [ 2 * #<_toolDist> ]] [#<_tool1Z>]
o8011 endsub

; tool 12
o8012 sub
  o<local-pick-up-tool> call [#<_tool1X> - [ 2 * #<_middleOffsetX> ]] [#<_tool1Y> - [ 3 * #<_toolDist> ]] [#<_tool1Z>]
o8012 endsub

; tool 13
o8013 sub
  o<local-pick-up-tool> call [#<_tool1X> - [ 2 * #<_middleOffsetX> ]] [#<_tool1Y> - [ 4 * #<_toolDist> ]] [#<_tool1Z>]
o8013 endsub

o<local-pick-up-tool> sub
  #<_toolX> = #1
  #<_toolY> = #2
  #<_toolZ> = #3
  #<_pickupFeed> = 300
  ;O<local-sync> call
  G53 G1 F#<_pickupFeed> X#<_toolX> Y#<_toolY>
  ;O<local-sync> call
  G53 G1 F#<_pickupFeed> Z#<_toolZ>
  M261
  G53 G1 F#<_pickupFeed> Z0
  ;O<local-sync> call
o<local-pick-up-tool> endsub

o<local-sync> sub
;  G4 P.2
  M66  E0 L0
o<local-sync> endsub
