o<probing-y> sub
  #<y> = #1
  #<overTravel> = #2
  #<toleranceCheck> = #3
  #<tolerancePosition> = #4
  #<updateWCS> = #5
  #<wcs> = #6
  #<printResults> = #7

  #<probeDiameter> = [ #5410 * [ #<_metric> * 25.4 + #<_imperial> ] ]
  #<fastFeed> =  [ #<_ini[TOOL_PROBE]FEED_FAST> * [ #<_metric> * 25.4 + #<_imperial> ]] 
  #<backFeed> = [ #<_ini[TOOL_PROBE]FEED_BACK> * [ #<_metric> * 25.4 + #<_imperial> ]] 
  #<slowFeed> = [ #<_ini[TOOL_PROBE]FEED_SLOW> * [ #<_metric> * 25.4 + #<_imperial> ]]

  #<startX> = #5420
  #<startY> = #5421
  #<startZ> = #5422

  #<dX> = [ 0 ]
  #<dY> = [ #<y> - #<startY> ]
  #<dZ> = [ 0 ]

  o500 if [ #<dY> GT 0 ]
    #<approach> = 1
  o500 else
    #<approach> = -1
  o500 endif

  #<dY> = [ #<dY> + [ #<approach> * #<overTravel> ] ]

  o<probe-relative> call [ #<dX> ] [ #<dY> ] [ #<dZ> ] [ #<fastFeed> ] [ #<backFeed> ] [ #<slowFeed> ]

  #<probedX> = #<_probedG5X_X>
  #<probedY> = [ #<_probedG5X_Y> + #<approach> * #<probeDiameter> * .5 ]
  #<probedZ> = #<_probedG5X_Z>

  #<deviation> = [ #<probedY> - #<y> ]

  o300 if [ #<printResults> EQ 1 ]
    (debug,Probed Y position #<probedY>, expected #<y>. Deviation: #<deviation>)
  o300 endif

  o600 if [ #<toleranceCheck> EQ 1 ]
    o200 if [ ABS [ #<deviation> ]  GT #<tolerancePosition> ]
       M66  E0 L0
      #<absDev> = [ ABS[ #<deviation> ] ]
      (abort,Probing Y failed positional tolerance check. Probed #<probedY>, expected #<y>. #<absDev> > #<tolerancePosition>)
    o200 endif
  o600 endif

  o400 if [ [ #<updateWCS> EQ 1 ] AND [ #<wcs> GE 1 ] AND [ #<wcs> LE 9 ]]
    ; The numbered parameters for the current wcs offsets are always in inches, so convert to active units.
    #<currentWCS_Y> = [ #[5222+20*[#5220-1]] * [ #<_metric> * 25.4 + #<_imperial> ] ]

    ; Then add the probed position
    #<newWCS_Y> = [ #<currentWCS_Y> + #<deviation> ]

    ; And store it in the appropriate WCS
    G10 L2 P#<wcs> Y#<newWCS_Y>
  o400 endif

o<probing-y> endsub
M2
