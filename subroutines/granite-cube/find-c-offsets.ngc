; An approximate tool length must be known at this point
; and must be active with G43 (see find-nominal-probe-length-offset).
; C should be mostly zeroed already

o<find-c-offsets> sub

o100 if [ #<_tool_offset> NE 1 ]
  (abort,You must have a tool length offset in place)
o100 endif

o<push_feature_set> call
M70

G20 
G90 G94 G40 G17 G91.1
M429

G53 G0 Z0

;F#<_ini[TOOL_PROBE]FEED_TRAVEL>
;G1 Y2.5 X1.75
;G1 Z0.67

;o<add-points-probe-line> call [-1] [0] [0] [0] [-1] [0] [2] [3.5] [0.51] [#<_ini[TOOL_PROBE]FEED_TRAVEL> ] [#<_ini[TOOL_PROBE]FEED_FAST> ] [#<_ini[TOOL_PROBE]FEED_BACK> ] [ #<_ini[TOOL_PROBE]FEED_SLOW> ] [1]
;
;G91 G0 C[ -#<_penta_line_angle_about_z> ]

;o<clear_points> call

F#<_ini[TOOL_PROBE]FEED_TRAVEL>
G90 G1 Y2.15 X2.25
G90 G1 Z1.52
G90 G1 X1.75
o<probe-on> call
o<add-points-probe-line> call [-1] [0] [0] [0] [-1] [0] [30] [3.5] [0.25] [#<_ini[TOOL_PROBE]FEED_TRAVEL> ] [#<_ini[TOOL_PROBE]FEED_FAST> ] [#<_ini[TOOL_PROBE]FEED_BACK> ] [ #<_ini[TOOL_PROBE]FEED_SLOW> ] [1]
o<probe-off> call

;py,append_feature_map("c-offsets")

G53 G0 Z0

;G91 G0 C[ -#<_penta_line_angle_about_z> ]

#<cOffset> = [ #5425 - #<_penta_line_angle_about_z> ]

;debug,C Offset #<cOffset>

(logappend,c-offsets.txt)
(log,#<cOffset>)
(logclose)

M72
o<pop_feature_set> call

o<find-c-offsets> endsub
M2
