o<solo-close-tool-changer> SUB
M66  E0 L0
G4 P0.2

M66 P#<_okToCloseToolChangerInput> L0
o300 if [ #5399 EQ 1 ]
  M164
  M66 P62 L3 Q4

  o100 if [ ABS[ #5399 +1 ] LT .000001 ]
    M66  E0 L0                           ; force synch
    (abort,Tool changer drawer failed to close.)
  o100 endif

  ; Check status of opened sensor, error if it still indicates the drawer is open
  M66 P63 L0
  o200 if [ ABS[ #5399-1 ] LT .000001 ]
    M66  E0 L0
    (abort,Tool changer drawer failed to close: opened sensor indicates drawer is opened.)
  o200 endif
o300 else
  M66  E0 L0
  (abort,Cannot close tool changer. Ensure drawer is open, spindle is fully retracted or moved aside and trunnion is out of the way.)
o300 endif

o<solo-close-tool-changer> ENDSUB
M2
